=#2#14= =#2#15= $%2; =#2#16= namespace rdl =#5#07= $%4; =#2#19= =#2#16= namespace xqc =#5#07= $%6 at $%8; =#2#19= =#2#16= namespace n =#5#07= $%10 at $%12; =#2#19= =#2#16= namespace a =#5#07= $%14 at $%16; =#2#19= =#2#16= namespace console =#5#07= $%18; =#2#17= =#2#18= $rdl:suffix =#2#1= $%20; =#2#17= =#2#18= $rdl:ncname =#2#1= $xqc:ncname; =#2#17= =#2#18= $rdl:chars =#2#1= $rdl:suffix =#6= $rdl:ncname =#6= $%22; =#2#17= =#2#18= $rdl:filter-regexp =#2#1= $%24; =#2#17= =#2#18= $rdl:paren-regexp =#2#1= concat($%26 =#1= $rdl:suffix =#1= $%28 =#1= $xqc:operator-regexp =#1= $%30 =#1= $rdl:chars =#1= $%32); =#2#17= =#2#18= $rdl:protocol-regexp =#2#1= $%34; =#2#17= =#21#06= rdl:map-put($map =#1= $key =#1= $val) =#20#06= map:new(($map =#1= =#21#07= =#20#06= $key =#26= $val =#20#07= )) =#20#07= ; =#2#17= =#21#06= rdl:parse-strings($strings =#24= core:element()* =#1= $normalizer =#1= $params) =#20#06= rdl:wrap(analyze-string($normalizer(string-join(for-each(1 =#7= count($strings) =#1= =#21#06= ($i) =#20#06= =#2#06= (name($strings =#20#01= $i =#20#02= ) =#5#01= $%36 =#2#07= $%38 =#6= $i =#2#08= $strings =#20#01= $i =#20#02= =#19#01= string() =#20#07= )) =#1= $params) =#1= $rdl:paren-regexp) =#19#01= fn:match =#1= $strings) =#20#07= ; =#2#17= =#21#06= rdl:normalize-query($query =#24= core:string()? =#1= $params) =#20#06= replace($query =#1= $%40 =#1= $%42) =#20#07= ; =#2#17= =#21#06= rdl:parse($query =#24= core:string()?) =#20#06= rdl:parse($query =#1= =#21#07= =#20#06= =#20#07= ) =#20#07= ; =#2#17= =#21#06= rdl:parse($query =#24= core:string()? =#1= $params) =#20#06= rdl:parse-strings( analyze-string($query =#1= $%44) =#19#01= * =#1= =#2#06= ($params($%46) =#5#07= $%48 =#2#07= xqc:normalize-query#2 =#2#08= rdl:normalize-query#2 =#1= $params ) =#20#07= ; =#2#17= =#21#06= rdl:get-index-from-tokens($tok) =#20#06= for-each(1 =#7= count(index-of($tok =#1= 1)) =#1= =#21#06= ($i) =#20#06= =#2#06= (exists(index-of($tok =#1= =#8#02= 1) =#20#01= $i =#20#02= ) =#4= index-of($tok =#1= =#8#02= 1) =#20#01= $i =#20#02= =#5#13= index-of($tok =#1= 1) =#20#01= $i =#20#02= =#2#07= () =#2#08= index-of($tok =#1= 1) =#20#01= $i =#20#02= =#8#01= 1 =#20#07= ) =#20#07= ; =#2#17= =#21#06= rdl:get-index($rest) =#20#06= rdl:get-index-from-tokens(for-each($rest =#1= =#21#06= ($_) =#20#06= =#2#06= ($_ =#19#01= fn:group =#20#01= =#20#08= nr =#5#07= 1 =#20#02= =#2#07= 1 =#2#08= =#2#06= ($_ =#19#01= fn:group =#20#01= =#20#08= nr =#5#07= 4 =#20#02= =#2#07= =#8#02= 1 =#2#08= 0 =#20#07= )) =#20#01= 1 =#20#02= =#20#07= ; =#2#17= =#21#06= rdl:clip-string($str =#24= core:string()) =#20#06= substring($str =#1= 2 =#1= string-length($str) =#8#02= 2) =#20#07= ; =#2#17= =#21#06= rdl:value-from-strings($val =#24= core:string()? =#1= $strings) =#20#06= =#25#01= TODO replace =#25#02= =#2#06= (matches($val =#1= $%50) =#2#07= concat($%52 =#1= rdl:clip-string($strings =#20#01= number(replace($val =#1= $%54 =#1= $%56)) =#20#02= ) =#1= $%58) =#2#08= $val =#20#07= ; =#2#17= =#21#06= rdl:append-or-nest($next =#1= $strings =#1= $group =#1= $ret =#1= $suffix) =#20#06= =#2#09= $x =#2#1= =#2#06= ($group =#20#01= =#20#08= nr =#5#07= 3 =#20#02= =#2#07= =#21#07= =#20#06= $%60 =#2#1= rdl:value-from-strings($group =#20#01= =#20#08= nr =#5#07= 3 =#20#02= =#19#01= string() =#1= $strings) =#1= $%62 =#2#1= rdl:wrap($next =#1= $strings) =#1= $%64 =#2#1= $suffix =#20#07= =#2#08= rdl:wrap($next =#1= $strings) =#2#11= =#2#06= (matches($group =#20#01= =#20#08= nr =#5#07= 2 =#20#02= =#19#01= string() =#1= $%66 =#6= $xqc:operator-regexp =#6= $%68) =#2#07= =#2#09= $operator =#2#1= $group =#20#01= =#20#08= nr =#5#07= 2 =#20#02= =#19#01= string() =#2#11= =#2#06= (array:size($ret) =#5#14= 0 =#2#07= =#2#09= $rev =#2#1= array:reverse($ret) =#2#09= $last =#2#1= array:head($rev) =#25#01= check =#2#06= preceded by comma =#25#02= =#2#09= $args =#2#1= =#2#06= (empty($last) =#2#07= $x =#2#08= =#20#01= $last =#1= $x =#20#02= =#2#11= array:append(array:reverse(array:tail($rev)) =#1= =#21#07= =#20#06= $%70 =#2#1= $operator =#1= $%72 =#2#1= $args =#1= $%74 =#2#1= $%76 =#20#07= ) =#2#08= array:append($ret =#1= =#21#07= =#20#06= $%78 =#2#1= $operator =#1= $%80 =#2#1= $x =#1= $%82 =#2#1= $%84 =#20#07= ) =#2#08= array:append($ret =#1= $x) =#20#07= ; =#2#17= =#21#06= rdl:append-prop-or-value($string =#1= $operator =#1= $strings =#1= $ret) =#20#06= =#2#06= (matches($operator =#1= $xqc:operator-regexp =#6= $%86) =#2#07= =#2#06= (array:size($ret) =#5#14= 0 =#2#07= xqc:operator-precedence( =#2#06= (exists($string) =#2#07= rdl:value-from-strings($string =#1= $strings) =#2#08= () =#1= $operator =#1= $ret) =#2#08= array:append($ret =#1= =#21#07= =#20#06= $%88 =#2#1= xqc:unary-op($operator) =#1= $%90 =#2#1= =#20#01= rdl:value-from-strings($string =#1= $strings) =#20#02= =#1= $%92 =#2#1= $%94 =#20#07= ) =#2#08= array:append($ret =#1= rdl:value-from-strings($string =#1= $strings)) =#20#07= ; =#2#17= =#21#06= rdl:wrap-open-paren($rest =#1= $strings =#1= $index =#1= $group =#1= $ret) =#20#06= rdl:wrap(subsequence($rest =#1= $index) =#1= $strings =#1= rdl:append-or-nest(subsequence($rest =#1= 1 =#1= $index) =#1= $strings =#1= $group =#1= $ret =#1= replace($rest =#20#01= $index =#8#02= 1 =#20#02= =#1= $%96 =#1= $%98))) =#20#07= ; =#2#17= =#21#06= rdl:wrap($rest =#1= $strings =#1= $ret =#1= $group) =#20#06= =#2#06= (exists($rest) =#2#07= =#2#06= ($group =#20#01= =#20#08= nr =#5#07= 4 =#20#02= =#2#07= rdl:wrap-open-paren($rest =#1= $strings =#1= rdl:get-index($rest) =#1= $group =#1= $ret) =#2#08= =#2#06= ($group =#20#01= =#20#08= nr =#5#07= 3 =#20#02= =#3= matches($group =#20#01= =#20#08= nr =#5#07= 2 =#20#02= =#19#01= string() =#1= $xqc:operator-regexp =#6= $%100) =#2#07= rdl:wrap($rest =#1= $strings =#1= rdl:append-prop-or-value($group =#20#01= =#20#08= nr =#5#07= 3 =#20#02= =#19#01= string() =#1= $group =#20#01= =#20#08= nr =#5#07= 2 =#20#02= =#19#01= string() =#1= $strings =#1= $ret)) =#2#08= rdl:wrap($rest =#1= $strings =#1= $ret) =#2#08= $ret =#20#07= ; =#2#17= =#21#06= rdl:wrap($match =#1= $strings =#1= $ret) =#20#06= rdl:wrap(tail($match) =#1= $strings =#1= $ret =#1= head($match) =#19#01= fn:group) =#20#07= ; =#2#17= =#21#06= rdl:wrap($match =#1= $strings) =#20#06= xqc:rename(rdl:wrap($match =#1= $strings =#1= =#20#01= =#20#02= ) =#1= =#21#06= ($name) =#20#06= =#2#06= (matches($name =#1= $xqc:operator-regexp) =#2#07= xqc:to-op(xqc:op-num($name)) =#2#08= $name =#20#07= ) =#20#07= ; =#2#17= =#21#06= rdl:import-module($name =#1= $params) =#20#06= =#2#09= $mappath =#2#1= =#2#06= (map:contains($params =#1= $%102) =#2#07= $params($%104) =#2#08= $%106 =#2#09= $map =#2#1= doc($mappath) =#19#01= root =#19#01= module =#2#09= $location =#2#1= core:anyURI($map =#20#01= =#20#08= name =#5#07= $name =#20#02= =#20#08= location) =#2#09= $uri =#2#1= core:anyURI($map =#20#01= =#20#08= name =#5#07= $name =#20#02= =#20#08= uri) =#2#09= $module =#2#1= =#2#06= ($location =#2#07= inspect:inspect-module($location) =#2#08= inspect:inspect-module-uri($uri) =#2#11= n:try(util:import-module(core:anyURI($module =#20#08= uri) =#1= $module =#20#08= prefix =#1= core:anyURI($module =#20#08= location)) =#1= ()) =#20#07= ; =#2#17= =#21#06= rdl:stringify($a =#1= $params) =#20#06= rdl:stringify($a =#1= $params =#1= true()) =#20#07= ; =#2#17= =#21#06= rdl:stringify($a =#1= $params =#1= $top) =#20#06= =#2#09= $s =#2#1= array:size($a) =#2#11= a:fold-left-at($a =#1= $%108 =#1= =#21#06= ($acc =#1= $t =#1= $i) =#20#06= =#2#09= $type =#2#1= =#2#06= ($t =#12= core:map(core:string()? =#1= core:item()?) =#2#07= 1 =#2#08= =#2#06= ($t =#12= core:array(core:item()?) =#2#07= 2 =#2#08= 0 =#2#09= $ret =#2#1= =#2#06= ($type =#5#01= 1 =#2#07= concat($t($%110) =#1= $%112 =#1= string-join(array:flatten(rdl:stringify($t($%114) =#1= $params =#1= false())) =#1= $%116) =#1= $%118 =#1= =#2#06= ($t($%120) =#12= core:string() =#2#07= $t($%122) =#2#08= $%124) =#2#08= =#2#06= ($type =#5#01= 2 =#2#07= concat($%126 =#1= rdl:stringify($t =#1= $params =#1= false()) =#1= $%128) =#2#08= $t =#2#11= concat($acc =#1= =#2#06= ($i =#5#14= 1 =#4= not($type =#5#01= 1 =#4= $t($%130) =#5#01= $%132) =#2#07= =#2#06= ($top =#2#07= $%134 =#2#08= $%136 =#2#08= $%138 =#1= $ret) =#20#07= ) =#20#07= ; =#2#17= =#21#06= rdl:exec($query =#1= $params) =#20#06= =#25#01= FIXME retrieve default-namespace =#25#02= =#2#09= $core =#2#1= n:import($%140) =#2#09= $n =#2#1= n:import($%142) =#2#11= =#2#06= (map:contains($params =#1= $%144) =#2#07= =#2#09= $module =#2#1= n:import($%146 =#6= $params($%148) =#6= $%150) =#2#09= $frame =#2#1= map:put($params =#1= $%152 =#1= =#21#07= =#20#06= $%154 =#26= $module =#20#07= ) =#2#11= $module($%156)($%158)(rdl:parse($query =#1= $params) =#1= $frame =#1= true()) =#2#08= =#2#09= $frame =#2#1= map:put($params =#1= $%160 =#1= =#21#07= =#20#06= $%162 =#26= $core =#1= $%164 =#26= $n =#20#07= ) =#2#11= n:eval(rdl:parse($query =#1= $params))($frame) =#20#07= ;
